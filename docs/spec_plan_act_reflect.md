# Plan/Act 処理仕様

## 概要
- 本ドキュメントでは、Plan→Act ワークフローの理想的な振る舞い・インターフェース・制約を整理する。
- ワークフローは1回の実行で完結し、Reflect ステージやリトライは含まない。

## Plan フェーズ
- **目的と入力条件**
	- ユーザー要求文を一次入力として受け取り、追加で参照可能なのはスキル一覧の `name` と `description` のみとする。
	- スキル本文や外部リソースへは参照せず、現在利用可能なスキルの概要を把握する前段整理に特化する。
- **主要な出力**
	- 要求文を自然言語で再記述し、ユーザーの目標・制約・文脈（例: 日本向けなど）を明示する導入段落。
	- スキル一覧から必要と判断したスキルを番号付き手順で列挙し、それぞれの目的を説明する。各手順は「まず〜」「次に〜」のような順序語を使用し、スキル名をそのまま記載する。
	- 要求達成のために最終的に行う作業内容をまとめた箇条書き（例: 「Anthropicのブランドカラーを反映した5枚のスライドを作成する」）。
- **必須の検証・制約**
	- 出力は日本語で統一し、ユーザー要求で示された対象地域や文脈（例: 「日本向け」）を反映する。
	- 手順は利用するスキルの `description` から合理的に推測できる範囲にとどめ、根拠のない工程を追加しない。
	- スキル参照が不要と判断される場合でも、判断理由を短く補足する。

## Act フェーズ
- **目的と入力条件**
	- Plan フェーズで選択されたスキルを順次実行し、ユーザー要求を満たす成果物を生成する。
- 各スキルの実行結果は AgenticScope（`act.output.<skillId>`）に保存され、後続のスキルから参照可能となる。
- **主要な出力**
	- 実行したスキルのリスト
	- 最終成果物（artifact）のパス（存在する場合）
	- 各スキルの実行結果（AgenticScope 上の `act.output.*` ステート）
- **必須の検証・制約**
	- Plan で指定された順序でスキルを実行する。
	- スキル実行中のエラーは即座に伝播し、ワークフロー全体が失敗する。

## フロー概要
- **フェーズ間のデータ受け渡し**
	- Plan フェーズの出力（選択されたスキルリスト、システムプロンプト要約）は AgenticScope に保存される。
	- Act フェーズは AgenticScope から Plan の結果を読み取り、スキルを順次実行する。
	- Act フェーズの出力（実行結果、artifact）も AgenticScope に保存される。
- **エラー/例外処理**
	- 各フェーズでのエラーは即座に伝播し、ワークフロー全体が失敗する。
	- リトライや再試行の機能は提供されない。
- **監視とテレメトリ**
	- AgentWorkflowObserver が各フェーズの前後でイベントを記録する。
	- ExecutionTelemetryReporter がワークフロー全体のメトリクス（LLM 呼び出し回数、トークン数など）を集計・出力する。

## 開発・検証ノート
- Reflect フェーズとリトライ機能は削除され、Plan→Act の直列実行のみとなった。
- 失敗時の再試行は上位レイヤー（CLI アプリケーションなど）で実装する必要がある。
