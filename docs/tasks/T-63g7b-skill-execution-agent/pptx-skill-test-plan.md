# T-63g7b pptxスキル テスト計画

## 目的

テストケースを作成することで、実行エンジンの達成基準を検証可能にする。

達成基準として、以下の pptx スキルが動作することを採用する。
<https://github.com/anthropics/skills/tree/main/skills/pptx>

対象スキルの実行には、適切なドキュメント（mdファイル）を読み、既存スクリプトを利用し、新規スクリプトを作成（既存スクリプトのパッチ適用や呼び出し）し、適切な順序で実行することで最終成果物（pptxファイル）を生成するパイプライン処理が必要である。

pptx スキルを調査し、ユースケースシナリオを列挙し、前提条件・達成条件・想定パイプラインを記述してテストケースを作成する。

## テスト計画

確認できた範囲の「pptx」スキル（`document-skills/pptx/` 配下）を前提に、実行エンジンの達成基準として使えるテストケースを組み立てる。まず、このスキルが要求している典型パイプラインを整理し、その分岐ごとにテストに落とし込む。

---

## 1. pptxスキルが前提にしているワークフロー（要点）

pptxスキルは、ユーザー要望を大きく3系統に分けている。

### A) 読む・分析する

- **テキストだけ読めればよい**：`markitdown` で `.pptx -> markdown` に変換する。
- **コメント、ノート、レイアウト、テーマなどが必要**：Office Open XML（以下、PowerPoint内部のXML）を**unpack**して生のXMLを見る。

### B) 新規作成（テンプレなし）

- HTMLスライドを用意し、`html2pptx.js` で PowerPoint に変換する（その上でチャートや表を差し込む）。
- 仕上げとして `scripts/thumbnail.py` でサムネイルを作り、崩れを見て直す。

### C) 既存pptxの編集（テンプレありも実質ここに寄る）

- `.pptx` を unpack → XML編集 → **validate**（編集のたびに必須）→ pack という反復。
- さらに「テンプレから作る」場合は、テンプレのテキスト抽出とサムネイル作成、在庫表（inventory）の作成を行い、どのスライドを複製して差し替えるか決める。

---

## 2. ユースケースシナリオ（実行エンジン観点での分類）

実行エンジンのテストに落としやすい形にすると、シナリオは次の5つにまとまる（ここが“分岐点”となる）。

1. **読み取り（テキスト抽出だけ）**
2. **読み取り（XMLまで必要）**
3. **新規作成（テンプレなし、HTML→PPTX）**
4. **既存編集（unpack/edit/validate/pack）**
5. **テンプレ準拠の新規作成（抽出＋棚卸し＋複製＋差し替え）**

この5分類それぞれで、「必要なmdを読む」「既存スクリプトを呼ぶ／足りなければ作る」「正しい順序で走らせる」を検証する。

---

## 3. テスト設計の前提（共通の前提条件と達成条件）

### 共通の前提条件（環境）

- Python実行ができること（`python -m markitdown`、各種 `*.py`）。
- Node.js実行ができること（`html2pptx.js` を動かす前提）。
- スキルフォルダ構造が存在すること（少なくとも `document-skills/pptx/` に `SKILL.md / html2pptx.md / ooxml.md / scripts/ / ooxml/` がある）。

### 共通の達成条件（エンジンとしての合格ライン）

- **必要なmdを必要なタイミングで読める**（特に “全文を読む” 指示を守れる）。
- **スクリプトの探索ができる**（パスが想定と違う場合に `find` で見つける指示がある）。
- **成果物が生成される**（pptxや中間生成物、サムネイル等が指示通りに出る）。
- **validate が失敗したら止まり、修正して再実行できる**（編集ワークフローの中核）。

---

## 4. 想定パイプライン（エンジンが組むべき処理の型）

テストケース内で参照する“型”として、最低限この4つを想定する。

- **P0: スキル起動**：対象スキルを選択 → `SKILL.md` を読む。
- **P1: 追加ドキュメント起動**：分岐に応じて `html2pptx.md` または `ooxml.md` を「全文」読む。
- **P2: スクリプト解決**：`scripts/` や `ooxml/scripts/` の実体パスを特定（必要なら `find` 実行）。
- **P3: 実行→成果物→検証**：変換／編集 → サムネイル or validate → 成功なら完了、失敗なら修正して再実行。

---

## 5. テストケース（実行エンジン検証用）

以下は「エンジンが“パイプラインを組んで成果物を出せるか”」に寄せたテストケースである。
各ケースは、**前提条件 / 入力 / 期待パイプライン / 達成条件**で記述する。

---

### PPTX-001：テキスト抽出のみ（markitdown経由）

**狙い**：最短分岐（PPTX→Markdown）を正しく選べる。

- 前提：入力 `sample.pptx` がある（内容は短文でよい）。
- 入力：ユーザー要望「このpptxの文章だけ抜き出して」
- 期待パイプライン：P0 → `python -m markitdown sample.pptx` 実行
- 達成条件：`sample.md`（または標準出力）にスライド文言が出る。エンジンがOOXML unpackへ行かない。

---

### PPTX-002：ノート・コメント要求（XML unpackへ分岐）

**狙い**：テキスト抽出で足りない要件を検知し、unpackへ分岐できる。

- 前提：ノート入り `notes.pptx` がある。
- 入力：ユーザー要望「スピーカーノートも含めて内容を確認したい」
- 期待パイプライン：P0 → P2 → `unpack.py` 実行 → `ppt/notesSlides/` 等を読む
- 達成条件：`ppt/notesSlides/notesSlide*.xml` を参照できている（ログで確認できる）。

---

### PPTX-003：スクリプトのパス揺れ耐性（findで解決）

**狙い**：`unpack.py` の場所が指示の想定パスと違っても動ける。

- 前提：スキルが `document-skills/pptx/ooxml/scripts/unpack.py` にある（実際の構造）。
- 入力：ユーザー要望「XMLを展開して構造を見たい」
- 期待パイプライン：P0 → （想定パス不一致を検出）→ `find . -name "unpack.py"` → 実体パスで実行
- 達成条件：ハードコードせずに `unpack.py` を発見して実行できる。

---

### PPTX-004：新規作成（テンプレなし、HTML→PPTX）

**狙い**：`html2pptx.md` を読ませ、HTML→PPTXの基本導線を通せる。

- 前提：Node.js実行可。出力先が書ける。
- 入力：ユーザー要望「3枚の紹介スライドを新規で作って」
- 期待パイプライン：P0 → P1（`html2pptx.md` を全文）→ スライドHTMLを3ファイル生成 → `html2pptx()` を呼ぶJSを生成・実行 → `output.pptx`
- 達成条件：`output.pptx` が生成される。HTMLファイルと変換JSが中間成果物として残る（またはログに出る）。

---

### PPTX-005：新規作成＋サムネイル検証（thumbnail.py）

**狙い**：スキルが要求する「作って終わりではなく、サムネイル出力まで」を実行できる。

- 前提：PPTX-004が通る。
- 入力：ユーザー要望「作ったpptxの見た目崩れがないか確認して」
- 期待パイプライン：P0→P1→生成→`python scripts/thumbnail.py output.pptx workspace/thumbnails --cols 4`
- 達成条件：サムネイル画像（グリッド）が生成される。エンジンが画像生成物を“検証対象”として扱える。

---

### PPTX-006：既存pptx編集（最小変更）＋validate＋pack

**狙い**：unpack/edit/validate/pack の反復を、順序どおりに実行できる。

- 前提：`editme.pptx` がある（タイトル文字列が入っている）。
- 入力：ユーザー要望「1枚目のタイトルをXに変えて」
- 期待パイプライン：P0→P1（`ooxml.md` 全文）→ unpack → `ppt/slides/slide1.xml` を編集 → `validate.py <dir> --original editme.pptx` → pack
- 達成条件：`output.pptx` が生成され、validateが成功する。

---

### PPTX-007：validate失敗時の停止と再実行

**狙い**：編集で壊したときに、validateを無視して進まないこと。

- 前提：PPTX-006と同じ。
- 入力：ユーザー要望「XMLをこう変えて」（わざと不正な編集を誘発するテスト入力）
- 期待パイプライン：unpack → edit → validate（失敗）→ **packしない** → 修正案生成 → 再edit → validate成功 → pack
- 達成条件：validate失敗を検知し、packを抑止できる（ログで確認できる）。

---

### PPTX-008：テーマ/フォント/色の抽出（theme1.xmlの参照）

**狙い**：デザイン模倣要求で、まずテーマと実スライドから色・フォントを拾う導線を踏める。

- 前提：ブランドっぽい配色の `brand.pptx` がある。
- 入力：ユーザー要望「このデザインに合わせて別の内容で作って」
- 期待パイプライン：unpack → `ppt/theme/theme1.xml` と `ppt/slides/slide1.xml` を読む → grepで色/フォント参照を探索
- 達成条件：抽出結果（色コード、フォント名）が、エンジンの中間メモ（ファイル or ログ）に残る。

---

### PPTX-009：テンプレ利用の新規作成（抽出＋棚卸し）

**狙い**：「テンプレから作る」分岐の前半（抽出と在庫表作成）まで通せる。

- 前提：`template.pptx` がある。
- 入力：ユーザー要望「このテンプレに沿って5枚の資料を作って」
- 期待パイプライン：`python -m markitdown template.pptx > template-content.md` → `python scripts/thumbnail.py template.pptx` → `template-inventory.md` を生成
- 達成条件：3点セット（`template-content.md`, サムネイル, `template-inventory.md`）が揃う。

---

### PPTX-010：テンプレ利用の新規作成（複製→差し替え→検証）

**狙い**：棚卸しを踏まえ、テンプレの該当スライドを複製して内容を差し替え、サムネイルで崩れ確認まで行く。

- 前提：PPTX-009が通る。
- 入力：ユーザー要望「棚卸しのカテゴリAのレイアウトで3枚増やして、中身を入れて」
- 期待パイプライン：inventory参照 →（複製・並べ替えはOOXML編集側に寄る想定）→ validate → pack → thumbnail生成
- 達成条件：`output.pptx` が生成され、validateが成功し、サムネイルも生成される。

---

### PPTX-011：追加ドキュメントの“必要時ロード”検証

**狙い**：毎回 `html2pptx.md` や `ooxml.md` を読むのではなく、分岐に応じて読める。

- 前提：スキル読み込みログが取れる。
- 入力：ケースA「テキスト抽出だけ」／ケースB「既存pptx編集」
- 期待パイプライン：Aでは `html2pptx.md` / `ooxml.md` を読まない、Bでは `ooxml.md` を全文読む
- 達成条件：ドキュメント読込ログが分岐どおり。

---

### PPTX-012：中間成果物のワークスペース分離（汚さない）

**狙い**：unpackしたディレクトリやHTML/PNGなどが、決めたワークスペース配下に集約される。

- 前提：作業ディレクトリ規約（例：`workspace/`）をエンジン側で持つ。
- 入力：新規作成（PPTX-004）と既存編集（PPTX-006）を連続実行
- 期待パイプライン：どちらも中間生成物が `workspace/<job-id>/...` に入る（混ざらない）
- 達成条件：2ジョブ実行後も成果物と中間物が衝突しない。

---

## 6. 補足（このテストセットで何が合格になるか）

このセットが通ると、少なくとも次が「上手く動いている達成基準」となる。

- `SKILL.md` の分岐（読む/作る/編集）を踏み外さない。
- “全文を読め” 指示のある `html2pptx.md` と `ooxml.md` を、必要なときに確実に読む。
- 既存スクリプト（`thumbnail.py`、`unpack.py`、`validate.py`、`pack.py`）を見つけて、順番どおりに実行できる。
- validate失敗時に握りつぶさず、止めて直してから進む。
